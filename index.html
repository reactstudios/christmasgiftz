<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ChristmassGiftz</title>

<style>
/* ===== RESPONSIVE BASE DESIGN ===== */
*, *::before, *::after { box-sizing: border-box; } 

body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:linear-gradient(135deg,#fffbe6,#fff2b3);
  color:#222; display: flex; justify-content: center; align-items: center;
  min-height: 100vh; overflow-x:hidden;
}
body::before{
  content:""; position:fixed; inset:0;
  background:url('https://images.unsplash.com/photo-1543589077-47d81606c1bf?auto=format&fit=crop&w=1600&q=80');
  background-size:cover; opacity:.12; z-index:-1;
}

.container{ width: 100%; max-width: 800px; padding: 15px; text-align: center; }
.card{
  background:rgba(255,255,255,.98); border-radius: 40px; padding: 50px 25px; 
  animation:fadeUp .7s ease; box-shadow: 0 25px 60px rgba(185, 150, 0, 0.2);
  width: 100%;
}

@media (max-width: 600px) {
  .card { padding: 35px 20px; border-radius: 30px; }
  h1 { font-size: 1.8rem !important; }
  h2 { font-size: 1.6rem !important; }
  .btn { font-size: 1.1rem !important; padding: 16px 20px !important; width: 100% !important; }
}

.hidden{display:none !important}
h1{ font-size: 3.2rem; color:#b99600; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 1px;}
h2{ font-size: 2.5rem; color:#b99600; margin-bottom: 15px;}
p { font-size: 1.1rem; line-height: 1.5; color: #555; }

.btn{
  background:linear-gradient(135deg,#ffd700,#fff099);
  border:none; padding:22px 50px; border-radius:100px;
  font-size: 1.4rem; font-weight:800; cursor:pointer;
  box-shadow:0 10px 25px rgba(255,215,0,0.4);
  margin:10px auto; transition:.3s; color: #443a00;
  display: block; width: 90%; text-decoration: none;
  -webkit-tap-highlight-color: transparent;
}
.btn:hover{transform:scale(1.02); box-shadow:0 15px 35px rgba(255,215,0,0.5);}

#rewardOverlay #rewardBox { width: 92%; max-width: 700px; padding: 40px 20px; }
.bigReward{ font-size: 3rem; font-weight:900; color:#d4a200; animation:glow 2s infinite; margin: 20px 0; }

#wheelOverlay, #rewardOverlay{
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.92); justify-content:center;
  align-items:center; z-index:1000; padding: 10px;
}
#wheelContainer{
    position:relative; width: 280px; height: 280px; margin:auto;
    border: 10px solid #d4af37; border-radius: 50%; background: #fff;
}
@media (min-width: 800px) { #wheelContainer { width: 450px; height: 450px; } }

#pointer {
    position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
    width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
    border-top: 40px solid #ff0000; z-index: 100;
}
canvas{ border-radius:50%; width: 100%; height: 100%; transition: transform 5s cubic-bezier(0.1, 0, 0.1, 1); }

.progressContainer{ width:100%; background:#f0f0f0; height:25px; border-radius:100px; overflow:hidden; margin: 20px 0; }
.progressBar{ height:100%; width:0%; background:linear-gradient(90deg,#ffd700,#ffb347); transition: width 0.8s ease; }

input { width: 100%; padding: 16px; margin: 10px 0; border-radius: 40px; border: 2px solid #eee; font-size: 1rem; }
.invite-link-box { background: #f9f9f9; padding: 15px; border-radius: 15px; border: 2px dashed #b99600; font-weight: bold; margin-bottom: 20px; font-size: 0.9rem; word-break: break-all; }

@keyframes fadeUp{ from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:none} }
@keyframes glow{ 0%, 100%{filter:drop-shadow(0 0 10px gold)} 50%{filter:drop-shadow(0 0 20px gold)} }
</style>
</head>
<body>

<div class="container">

<div id="home" class="card">
  <h1>CHRISTMASGIFTZ</h1>
  <p>Exclusive Holiday Giveaway. Try your luck and win premium prizes today!</p>
  <img src="https://images.unsplash.com/photo-1608889175250-c3b0c1667b5d?auto=format&fit=crop&w=400" style="width:200px; max-width: 60%; margin: 20px 0;">
  <button class="btn" id="tryBtn">SPIN NOW</button>
</div>

<div id="wheelOverlay">
  <div id="wheelBox" class="card" style="width: 100%; max-width: 550px;">
    <h2>TAP TO SPIN</h2>
    <div id="wheelContainer">
      <canvas id="wheel" width="450" height="450"></canvas>
      <div id="pointer"></div>
    </div>
  </div>
</div>

<div id="rewardOverlay">
  <div id="rewardBox" class="card">
    <h3>CONGRATULATIONS!</h3>
    <div id="rewardText" class="bigReward"></div>
    <img id="rewardImg" style="width:240px; max-width: 80%; border-radius:30px; border: 5px solid gold; margin-bottom: 20px;">
    <button class="btn" id="goInvite">CLAIM MY PRIZE</button>
  </div>
</div>

<div id="invite" class="card hidden">
  <h2>SHARE TO CLAIM</h2>
  <p>Share with 7 friends to continue to the final step.</p>
  <div class="invite-link-box">https://christmasgiftz.com/win?id=7721</div>
  <button class="btn" id="wa" style="background:#25D366; color:white;">WhatsApp</button>
  <button class="btn" id="ig" style="background:#E1306C; color:white;">Instagram</button>
  <button class="btn" id="tg" style="background:#0088cc; color:white;">Telegram</button>
  <button class="btn" id="tw" style="background:#1DA1F2; color:white;">Twitter</button>
  <p id="inviteStatus" style="font-weight: 800; font-size: 1.3rem; margin: 15px 0;">Invited: 0 / 7</p>
  <button class="btn hidden" id="toSurvey" style="background: #b99600; color: white;">PROCEED TO SURVEY</button>
</div>

<div id="surveyPage" class="card hidden">
  <h2>VERIFICATION</h2>
  <p>Complete the task below to claim your reward.</p>
  <div class="progressContainer"><div id="bar" class="progressBar"></div></div>
  <p id="progStatus" style="font-size: 1.3rem; font-weight: bold;">0% Complete</p>
  <button class="btn" id="openOffer">OPEN SURVEY TASK</button>
  <button class="btn hidden" id="toDetails" style="background: #28a745; color: white;">PROCEED TO SHIPPING</button>
</div>

<div id="details" class="card hidden">
  <h2>SHIPPING INFO</h2>
  <input type="text" placeholder="Full Name">
  <input type="text" placeholder="Address">
  <input type="email" placeholder="Email">
  <button class="btn" onclick="alert('Success! Your package is being prepared.')">SUBMIT DETAILS</button>
</div>

</div>

<script>
// --- Initialize User ID ---
let userId = localStorage.getItem("cpx_user_id");
if (!userId || userId === "0") {
    userId = "user_" + Math.random().toString(36).substring(2, 10);
    localStorage.setItem("cpx_user_id", userId);
}

const rewards=[
 {name:"iPhone 17 Pro", img:"https://m.media-amazon.com/images/I/71MXmswILHL._SX679_.jpg"},
 {name:"Galaxy Watch", img:"https://m.media-amazon.com/images/I/81JDB+5rbiL._SX679_.jpg"},
 {name:"Sony Audio", img:"https://m.media-amazon.com/images/I/71czPeQzIwL._SX522_.jpg"},
 {name:"Amazon Card", img:"https://m.media-amazon.com/images/I/31pEIqONsqL._SX342_.jpg"},
 {name:"Xiaomi Pad", img:"https://m.media-amazon.com/images/I/71yZPdov-SL._SX522_.jpg"}
];

let selectedReward = null;
let inviteCount = 0;
let surveyProgress = 0;
let surveyActive = false;

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const sliceDeg = 360 / rewards.length;

function drawWheel() {
  rewards.forEach((r, i) => {
    const angle = (i * sliceDeg) * Math.PI / 180;
    ctx.beginPath();
    ctx.moveTo(225, 225);
    ctx.arc(225, 225, 225, angle, angle + (sliceDeg * Math.PI / 180));
    ctx.fillStyle = i % 2 ? "#FFD700" : "#FFB347";
    ctx.fill();
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = r.img;
    img.onload = () => {
        ctx.save(); ctx.translate(225, 225); ctx.rotate(angle + (sliceDeg / 2) * Math.PI / 180);
        ctx.drawImage(img, 120, -40, 80, 80); ctx.restore();
    };
  });
}
drawWheel();

document.getElementById("tryBtn").onclick = () => { 
    document.getElementById("home").classList.add("hidden"); 
    document.getElementById("wheelOverlay").style.display = "flex"; 
};

canvas.onclick = () => {
    if(selectedReward) return;
    const randomIdx = Math.floor(Math.random() * rewards.length);
    selectedReward = rewards[randomIdx];
    const stopAt = 3600 + (270 - (randomIdx * sliceDeg) - (sliceDeg / 2));
    canvas.style.transform = `rotate(${stopAt}deg)`;
    setTimeout(() => {
        document.getElementById("wheelOverlay").style.display = "none";
        document.getElementById("rewardText").innerText = selectedReward.name;
        document.getElementById("rewardImg").src = selectedReward.img;
        document.getElementById("rewardOverlay").style.display = "flex";
    }, 5500);
};

document.getElementById("goInvite").onclick = () => { 
    document.getElementById("rewardOverlay").style.display = "none";
    document.getElementById("invite").classList.remove("hidden");
};

function handleInvite(url) {
    inviteCount++;
    document.getElementById("inviteStatus").innerText = `Invited: ${inviteCount} / 7`;
    if(inviteCount >= 7) document.getElementById("toSurvey").classList.remove("hidden");
    if(url !== "#") window.open(url, "_blank");
}

document.getElementById("wa").onclick = () => handleInvite("whatsapp://send?text=" + encodeURIComponent(window.location.href));
document.getElementById("tg").onclick = () => handleInvite("https://t.me/share/url?url=" + encodeURIComponent(window.location.href));
document.getElementById("tw").onclick = () => handleInvite("https://twitter.com/intent/tweet?url=" + encodeURIComponent(window.location.href));
document.getElementById("ig").onclick = () => { alert("Post Link to Story!"); handleInvite("#"); };

document.getElementById("toSurvey").onclick = () => { 
    document.getElementById("invite").classList.add("hidden"); 
    document.getElementById("surveyPage").classList.remove("hidden"); 
};

// --- FIXED USER ID IN SURVEY ---
document.getElementById("openOffer").onclick = () => {
    const currentId = localStorage.getItem("cpx_user_id");
    surveyActive = true;
    window.open("https://offers.cpx-research.com/index.php?app_id=30494&user_id=" + currentId, "_blank");
};

window.onfocus = () => {
    if(surveyActive && surveyProgress < 100) {
        surveyProgress += 25;
        document.getElementById("bar").style.width = surveyProgress + "%";
        document.getElementById("progStatus").innerText = `${surveyProgress}% Complete`;
        if(surveyProgress >= 25) document.getElementById("toDetails").classList.remove("hidden");
        if(surveyProgress >= 100) document.getElementById("openOffer").innerText = "VERIFIED âœ“";
        surveyActive = false;
    }
};

document.getElementById("toDetails").onclick = () => { 
    document.getElementById("surveyPage").classList.add("hidden"); 
    document.getElementById("details").classList.remove("hidden"); 
};
</script>

</body>
</html>